<!DOCTYPE html>
<html>
  <head>
    <title>Simple Marker</title>
    <!-- The callback parameter is required, so we use console.debug as a noop -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

  </head>

  <body>

    <div class="container">

        <br><br>

        <h1 class="text-center"> Nearby Places Finder</h1>
        <div id="map"></div>
        <div class="form-group">
            <label for="autocomplete">Enter Location</label>
            <br><br>
            <input type = "text" class="form-control" id="autocomplete" placeholder="Enter Location">
            <br>
            <button class = "btn btn-primary" onclick="searchNearbyPlaces()">Use My Location Instead</button>

        </div>
        <br>
        <div class = "form-group">
            <label for="type">Select Place Type</label>

            <select id = "type" class="form-control">
                <option id = 'tourist_attraction' value="tourist_attraction">tourist_attraction</option>
                <option id='restaurant' value="restaurant">Restaurant</option>
                <option id='shopping_mall' value="shopping_mall">Shopping mall</option>
                <option id='club' value="club">Club</option>
                <option id='cafe' value="cafe">Cafe</option>
                <option id='park' value="park">Park</option>
                <option id='beauty_salon' value="beauty_salon">Beauty Salon</option>
                <option id='amusement_park' value="amusement_park">Amusement Park</option>
                <option id='mosque' value="mosque">Mosque</option>
                <option id='movie_theater' value="movie_theater">Movie Theatre</option>
                <option id='museum' value="museum">Museum</option>
                <option id='supermarket' value="supermarket">Supermarket</option>
                

            </select>
            <br>
            
            <label for="Radius">Radius: </label>
            <input type = "text" class="form-control" id="radius" placeholder="Enter Radius">

            <br>
            <button class = "btn btn-primary" onclick="searchNearbyPlaces()">Get Direction</button>
        </div>

        <br><br>

        <table class="table table-bordered table striped" id="places">

        </table>
    </div>


  </body> 

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyALQ-4LUr6mNIndbvdCCB_1hZhtQ_LtOUg&libraries=places&callback=initMap" async defer>
</script>

<script>

function initMap()
{
    if (google && google.maps && google.maps.places) 
    {
        console.log("Hello, this is a message printed to the console!");
        autocomplete = new google.maps.places.Autocomplete((document.getElementById('autocomplete')), {
            types: ['geocode']
        });
        console.log("Hello, this is a message printed to the console!");
        
        autocomplete.addListener('places_changed', searchNearbyPlaces);
        console.log("Hello, this is a message printed to the console!");
    } else {
        // If the Places library is not loaded, try again after a short delay
        setTimeout(initMap, 100);
    }
}

function searchNearbyPlaces()
{
    console.log("Places changed event triggered!");
    document.getElementById('places').innerHTML = ''

    //enter radius
    var radiusInput = document.getElementById('radius');
    var radius = parseInt(radiusInput.value, 10); 

    var place  = autocomplete.getPlace()
    console.log(place)

    var type = document.getElementById('type').value

    map = new google.maps.Map(document.getElementById('map'),
    {
        center:place.geometry.location,
        zoom: 15
    });

    service = new google.maps.places.PlacesService(map);
    service.nearbySearch(
        {
            location:place.geometry.location,
            radius : radius,
            type: [type]
        }, callback);
}


function callback(results, status)
{
    if(status == google.maps.places.PlacesServiceStatus.OK)
    {
        console.log(results.length)
        for(var i = 0; i<results.length;i++)
        {
            createMarker(results[i]);            
        }
    }
}


function createMarker(place)
{
    console.log(place)
    var table = document.getElementById("places");
    var row = table.insertRow();
    var cell1 = row.insertCell(0);
    cell1.innerHTML = place.name;

    if(place.photos)
    {
        let photoUrl = place.photos[0].getUrl();
        let cell2 = row.insertCell(1)
        cell2.innerHTML = `<img width = "300" height = " 300" src="${photoUrl}"/>`
    }
    else
    {
        let photoUrl = "https://via.placeholder.com/150"
        let cell2 = row.insertCell(1)
        cell2.innerHTML = `<img width="300" height= "300" src="${photoUrl}"/>`
    }
}


</script>

  </html>