<!DOCTYPE html>
<html>
  <head>
    <title>Simple Marker</title>
    <!-- The callback parameter is required, so we use console.debug as a noop -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

  </head>

  <body>

    <div class="container">

        <br><br>

        <h1 class="text-center"> Nearby Places Finder</h1>
        <div id="map"></div>
        <div class="form-group">
            <label for="autocomplete">Enter Location</label>
            <br><br>
            <input type = "text" class="form-control" id="autocomplete" placeholder="Enter Location">

        </div>
        <br>
        <div class = "form-group">
            <label for="type">Select Place Type</label>

            <select id = "type" class="form-control">
                <option id = 'tourist_attraction'>tourist_attraction</option>
                <option id='school'>School</option>
                <option id='post_office'>Post Office</option>
                <option id='real_estate_agency'>Real Estate Agency</option>
                <option id='roofing_contractor'>Roofing Contractor</option>
                <option id='school'>School</option>
                <option id='shoe_store'>Shoe Store</option>
                <option id='spa'>Spa</option>
                <option id='storage'>Storage</option>
                <option id='subway_station'>Subway Station</option>
                <option id='taxi_stand'>Taxi Stand</option>
                <option id='train_station'>Train Station</option>
                <option id='travel_agency'>Travel Agency</option>
                <option id='veterinary_care'>Veterinary Care</option>
                <option id='car_park'>Car Park</option>
                <option id='drugstore'>Drugstore</option>
                <option id='home_goods_store'>Home Goods Store</option>
                <option id='jewelry_store'>Jewelry Store</option>
                <option id='liquor_store'>Liquor Store</option>
                <option id='meal_delivery'>Meal Delivery</option>
                <option id='meal_takeaway'>Meal Takeaway</option>
                <option id='mosque'>Mosque</option>
                <option id='painter'>Painter</option>
                <option id='place_of_worship'>Place of Worship</option>
                <option id='police'>Police</option>
                <option id='restaurant'>Restaurant</option>
                <option id='shoe_repair'>Shoe Repair</option>
                <option id='supermarket'>Supermarket</option>
                <option id='university'>University</option>
                <option id='veterinary_care'>Veterinary Care</option>
                <option id='zoo'>Zoo</option>
            </select>

            <button class = "btn btn-primary" onclick="searchNearbyPlaces()">Get Direction</button>
        </div>

        <br><br>

        <table class="table table-bordered table striped" id="places">

        </table>
    </div>


  </body> 

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyALQ-4LUr6mNIndbvdCCB_1hZhtQ_LtOUg&libraries=places&callback=initMap" async defer>
</script>

<script>

function initMap()
{
    if (google && google.maps && google.maps.places) 
    {
        console.log("Hello, this is a message printed to the console!");
        autocomplete = new google.maps.places.Autocomplete((document.getElementById('autocomplete')), {
            types: ['geocode']
        });
        console.log("Hello, this is a message printed to the console!");
        
        autocomplete.addListener('places_changed', searchNearbyPlaces);
        console.log("Hello, this is a message printed to the console!");
    } else {
        // If the Places library is not loaded, try again after a short delay
        setTimeout(initMap, 100);
    }
}

function searchNearbyPlaces()
{
    console.log("Places changed event triggered!");
    document.getElementById('places').innerHTML = ''
    console.log("gg");

    var place  = autocomplete.getPlace()
    console.log(place)

    map = new google.maps.Map(document.getElementById('map'),
    {
        center:place.geometry.location,
        zoom: 15
    });

    service = new google.maps.places.PlacesService(map);
    service.nearbySearch(
        {
            location:place.geometry.location,
            radius : '500',
            type: [document.getElementById('type').value]
        }, callback);
}


function callback(results, status)
{
    if(status == google.maps.places.PlacesServiceStatus.OK)
    {
        console.log(results.length)
        for(var i = 0; i<results.length;i++)
        {
            createMarker(results[i]);            
        }
    }
}


function createMarker(place)
{
    console.log(place)
    var table = document.getElementById("places");
    var row = table.insertRow();
    var cell1 = row.insertCell(0);
    cell1.innerHTML = place.name;

    if(place.photos)
    {
        let photoUrl = place.photos[0].getUrl();
        let cell2 = row.insertCell(1)
        cell2.innerHTML = `<img width = "300" height = " 300" src="${photoUrl}"/>`
    }
    else
    {
        let photoUrl = "https://via.placeholder.com/150"
        let cell2 = row.insertCell(1)
        cell2.innerHTML = `<img width="300" height= "300" src="${photoUrl}"/>`
    }
}


</script>

  </html>